<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA / Android Meta Tags -->
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>TubePro Premium</title>

    <!-- INLINE MANIFEST (Makes it installable without a separate file) -->
    <link rel="manifest" href='data:application/manifest+json,{"name":"TubePro Premium","short_name":"TubePro","start_url":".","display":"standalone","background_color":"#000000","theme_color":"#ff2d55","icons":[{"src":"https://cdn-icons-png.flaticon.com/512/712/712217.png","sizes":"512x512","type":"image/png"}]}'>
    
    <style>
        :root {
            --primary: #ff2d55;
            --bg: #000000;
            --surface: #121212;
            --surface-light: #1c1c1e;
            --text-main: #ffffff;
            --text-dim: #a1a1a6;
            --accent-gradient: linear-gradient(145deg, #ff2d55 0%, #ff512f 100%);
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); color: var(--text-main); overflow: hidden; height: 100vh; width: 100vw; }

        /* --- SPLASH SCREEN --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg);
            z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: 0.8s cubic-bezier(0.77, 0, 0.175, 1);
        }
        .app-logo-frame {
            width: 100px; height: 100px; background: var(--accent-gradient); border-radius: 24px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 40px rgba(255, 45, 85, 0.4);
            animation: bounceIn 1s ease;
        }
        @keyframes bounceIn { 0%{transform:scale(0.3);opacity:0} 70%{transform:scale(1.1)} 100%{transform:scale(1)} }

        /* --- CONTENT WRAPPER --- */
        #app-wrapper { height: 100%; display: flex; flex-direction: column; opacity: 0; transition: 0.5s; padding-top: var(--safe-top); }
        .container { padding: 20px; flex: 1; overflow-y: auto; padding-bottom: 100px; }

        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .logo-text { font-size: 24px; font-weight: 800; letter-spacing: -1px; }
        .logo-text span { color: var(--primary); }

        .search-card {
            background: var(--surface); border-radius: 20px; padding: 8px; margin-bottom: 20px;
            border: 1px solid #2c2c2e; display: flex; align-items: center;
        }
        input { flex: 1; background: transparent; border: none; color: white; padding: 12px; font-size: 16px; outline: none; }
        .paste-btn { background: #333; color: white; border: none; padding: 10px 15px; border-radius: 14px; font-size: 11px; font-weight: 800; }

        .main-btn {
            width: 100%; background: var(--accent-gradient); height: 58px; border-radius: 18px;
            border: none; color: white; font-size: 16px; font-weight: 700;
            box-shadow: 0 10px 25px rgba(255, 45, 85, 0.3); display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .main-btn:active { transform: scale(0.98); }

        /* --- RESULTS --- */
        #result-box { display: none; background: var(--surface); border-radius: 24px; margin-top: 25px; overflow: hidden; border: 1px solid #2c2c2e; animation: fadeInUp 0.5s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .thumb { width: 100%; height: 200px; object-fit: cover; background: #222; }
        .dl-item { background: var(--surface-light); margin: 10px 15px; padding: 15px; border-radius: 15px; display: flex; justify-content: space-between; text-decoration: none; color: white; font-weight: 600; font-size: 14px; border-left: 4px solid var(--primary); }

        /* --- NAVIGATION --- */
        nav { position: fixed; bottom: 0; width: 100%; height: 75px; background: rgba(0,0,0,0.9); backdrop-filter: blur(15px); display: flex; justify-content: space-around; border-top: 1px solid #222; }
        .nav-link { display: flex; flex-direction: column; align-items: center; justify-content: center; color: #666; font-size: 11px; text-decoration: none; width: 33.3%; }
        .nav-link.active { color: var(--primary); }
        .nav-icon { font-size: 22px; margin-bottom: 4px; }

        /* --- INSTALL PAGE --- */
        #install-screen { display: none; height: 100%; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 40px; }
        .big-icon { width: 100px; height: 100px; background: var(--accent-gradient); border-radius: 25px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; font-size: 50px; }

        #toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 12px 25px; border-radius: 30px; font-size: 13px; opacity: 0; transition: 0.3s; z-index: 10000; pointer-events: none; }
        .spinner { width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3); border-top-color: #fff; border-radius: 50%; animation: spin 1s linear infinite; display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="splash-screen">
        <div class="app-logo-frame">
            <svg width="50" height="50" viewBox="0 0 24 24" fill="white"><path d="M10 15.5l6-3.5-6-3.5v7zM19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65z"/></svg>
        </div>
        <p style="margin-top:20px; letter-spacing:3px; font-weight:bold; font-size:12px; color:#444">POWERED BY TUBEPRO</p>
    </div>

    <div id="app-wrapper">
        <div id="home-screen" class="container">
            <header>
                <div class="logo-text">Tube<span>Pro</span></div>
                <div style="background:#222; font-size:10px; padding:5px 12px; border-radius:20px; font-weight:900">PREMIUM</div>
            </header>

            <div class="search-card">
                <input type="text" id="url-input" placeholder="Paste YouTube link here...">
                <button class="paste-btn" onclick="doPaste()">PASTE</button>
            </div>

            <button class="main-btn" onclick="fetchMedia()">
                <span id="btn-txt">GENERATE LINKS</span>
                <div id="btn-load" class="spinner"></div>
            </button>

            <div id="result-box">
                <img id="vid-thumb" class="thumb" src="">
                <div style="padding:15px">
                    <h3 id="vid-title" style="font-size:16px; margin-bottom:10px">Video Title</h3>
                    <div id="download-links"></div>
                </div>
            </div>
        </div>

        <div id="install-screen">
            <div class="big-icon">üì•</div>
            <h2>Install TubePro</h2>
            <p style="color:var(--text-dim); margin:15px 0 30px">Get the native Android experience with faster downloads and no browser bars.</p>
            <button class="main-btn" onclick="installNow()">INSTALL APP</button>
        </div>

        <nav>
            <a href="#" class="nav-link active" onclick="switchTab('home', this)">
                <span class="nav-icon">üè†</span><span>Home</span>
            </a>
            <a href="#" class="nav-link" onclick="switchTab('install', this)">
                <span class="nav-icon">üì≤</span><span>Install</span>
            </a>
        </nav>
    </div>

    <div id="toast">Message</div>

    <script>
        const API_KEY = '90bfa2b57fmsh2fe4c43945ce012p1255b3jsnf099f32e30df'; 
        const API_HOST = 'youtube-media-downloader.p.rapidapi.com';
        let deferredPrompt;

        // --- STARTUP ---
        window.addEventListener('load', () => {
            // Register dummy service worker to enable installation
            if ('serviceWorker' in navigator) {
                const swCode = `self.addEventListener('fetch', function(event) { event.respondWith(fetch(event.request)); });`;
                const blob = new Blob([swCode], {type: 'text/javascript'});
                const url = URL.createObjectURL(blob);
                navigator.serviceWorker.register(url);
            }
            
            setTimeout(() => {
                document.getElementById('splash-screen').style.transform = 'scale(2)';
                document.getElementById('splash-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('splash-screen').style.display = 'none';
                    document.getElementById('app-wrapper').style.opacity = '1';
                }, 600);
            }, 2000);
        });

        // --- PWA INSTALL LOGIC ---
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });

        async function installNow() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') showToast("Installing...");
                deferredPrompt = null;
            } else {
                showToast("Already installed or Browser not supported");
            }
        }

        // --- NAVIGATION ---
        function switchTab(tab, el) {
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            document.getElementById('home-screen').style.display = (tab === 'home' ? 'block' : 'none');
            document.getElementById('install-screen').style.display = (tab === 'install' ? 'flex' : 'none');
        }

        function showToast(m) {
            const t = document.getElementById('toast');
            t.innerText = m; t.style.opacity = '1';
            setTimeout(() => t.style.opacity = '0', 3000);
        }

        async function doPaste() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('url-input').value = text;
            } catch (e) { showToast("Permission denied. Paste manually."); }
        }

        // --- FETCHING LOGIC (FIXED) ---
        async function fetchMedia() {
            const input = document.getElementById('url-input').value.trim();
            if(!input) return showToast("Please paste a URL first");

            const btnTxt = document.getElementById('btn-txt');
            const loader = document.getElementById('btn-load');
            const resBox = document.getElementById('result-box');

            // Extraction
            let vidId = "";
            try {
                if(input.includes('v=')) vidId = input.split('v=')[1].split('&')[0];
                else vidId = input.split('/').pop().split('?')[0];
            } catch(e) { return showToast("Invalid YouTube URL"); }

            btnTxt.style.display = 'none';
            loader.style.display = 'block';
            resBox.style.display = 'none';

            const apiURL = `https://${API_HOST}/v2/video/details?videoId=${vidId}`;
            
            try {
                // Using a more reliable proxy for RapidAPI headers
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(apiURL)}`);
                const outerData = await response.json();
                
                // Fetch again with headers directly if proxy fails or try different approach
                const actualResponse = await fetch(apiURL, {
                    method: 'GET',
                    headers: {
                        'x-rapidapi-key': API_KEY,
                        'x-rapidapi-host': API_HOST
                    }
                });

                if(!actualResponse.ok) throw new Error("API_LIMIT_OR_KEY_ERROR");
                
                const data = await actualResponse.json();

                if(!data.title) throw new Error("NO_DATA");

                document.getElementById('vid-thumb').src = data.thumbnails[data.thumbnails.length-1].url;
                document.getElementById('vid-title').innerText = data.title;
                
                const linkArea = document.getElementById('download-links');
                linkArea.innerHTML = '';

                // Add Video Links
                if(data.videos && data.videos.items) {
                    data.videos.items.slice(0, 3).forEach(v => {
                        linkArea.innerHTML += `<a href="${v.url}" class="dl-item" target="_blank">
                            <span>Video ${v.quality}</span><span>${v.extension.toUpperCase()}</span>
                        </a>`;
                    });
                }

                // Add Audio Link
                if(data.audios && data.audios.items) {
                    const a = data.audios.items[0];
                    linkArea.innerHTML += `<a href="${a.url}" class="dl-item" style="border-left-color:#00ff88" target="_blank">
                        <span>Audio Only</span><span>MP3</span>
                    </a>`;
                }

                resBox.style.display = 'block';
            } catch (err) {
                console.error(err);
                showToast("Connection Error. Check API Key or Internet.");
            } finally {
                btnTxt.style.display = 'block';
                loader.style.display = 'none';
            }
        }
    </script>
</body>
</html>
